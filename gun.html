<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Günlük Görünüm - AERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #fffaf3;
      margin: 0;
      padding: 20px;
    }

    .ust-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .tarih {
      font-size: 20px;
      font-weight: bold;
      color: #4a3b2c;
    }

    .aera-logo {
      font-size: 20px;
      color: #fa5f1a;
      font-weight: bold;
    }

    .gorev {
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      position: relative;
    }

    .saat {
      font-size: 14px;
      font-weight: normal;
    }

    .gorev .butonlar {
      margin-top: 8px;
      display: flex;
      gap: 10px;
    }

    .gorev .butonlar button {
      background-color: white;
      color: black;
      border: none;
      padding: 6px 12px;
      border-radius: 6px;
      cursor: pointer;
    }

    .gorev .butonlar button:hover {
      opacity: 0.8;
    }

    .alt-butonlar {
      margin-top: 20px;
      display: flex;
      justify-content: space-between;
    }

    .alt-butonlar button {
      background-color: #4a3b2c;
      color: white;
      border: none;
      padding: 12px 20px;
      border-radius: 10px;
      font-size: 14px;
      cursor: pointer;
    }

    .alt-butonlar button:hover {
      background-color: #3a2c20;
    }

    #notOkuBtn {
      display: none;
      margin-top: 10px;
      background-color: #fa5f1a;
    }
  </style>
</head>
<body>

  <div class="ust-bar">
    <div class="tarih" id="tarihGoster">Yükleniyor...</div>
    <div class="aera-logo">AERA</div>
  </div>

  <div id="gorevListesi"></div>
  <button id="notOkuBtn" onclick="notuOku()">Notu Oku</button>

  <div class="alt-butonlar">
    <button onclick="yeniGorev()">Görev Ekle</button>
    <button onclick="yeniNot()">Not Ekle</button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const gun = params.get("gun");
    const ay = params.get("ay");
    const yil = params.get("yil");
    const aktifKullanici = localStorage.getItem("aktifKullanici");
    const seciliTarih = `${yil}-${ay.padStart(2, '0')}-${gun.padStart(2, '0')}`;

    const tarihObj = new Date(parseInt(yil), parseInt(ay) - 1, parseInt(gun));
    const tarihMetni = tarihObj.toLocaleDateString("tr-TR", {
      day: 'numeric',
      month: 'long',
      year: 'numeric'
    });

    document.getElementById("tarihGoster").textContent = tarihMetni;

    const gorevler = JSON.parse(localStorage.getItem("gorevler") || "[]");
    const bugunkuGorevler = gorevler.filter(g =>
      g.tarih === seciliTarih && g.kullanici === aktifKullanici
    ).sort((a, b) => a.saat.localeCompare(b.saat));

    const liste = document.getElementById("gorevListesi");
    bugunkuGorevler.forEach((gorev, index) => {
      const div = document.createElement("div");
      div.className = "gorev";
      div.style.backgroundColor = gorev.renk;
      div.innerHTML = `
        <div>${gorev.ad}</div>
        <div class="saat">${gorev.saat}</div>
        <div class="butonlar">
          <button onclick="tamamlaGorev('${gorev.ad}', '${gorev.saat}')">Tamamla</button>
          <button onclick="duzenleGorev('${gorev.ad}', '${gorev.saat}')">Düzenle</button>
        </div>
      `;
      liste.appendChild(div);
    });

    function tamamlaGorev(ad, saat) {
      let gorevler = JSON.parse(localStorage.getItem("gorevler") || "[]");
      const guncellenmis = gorevler.filter(g => !(g.ad === ad && g.saat === saat && g.tarih === seciliTarih && g.kullanici === aktifKullanici));
      localStorage.setItem("gorevler", JSON.stringify(guncellenmis));

      // XP işlemleri
      let xp = parseInt(localStorage.getItem("xp") || "0");
      xp += 10;
      localStorage.setItem("xp", xp);

      alert("Görev tamamlandı. 10 XP kazandınız!");
      location.reload();
    }

    function duzenleGorev(ad, saat) {
      localStorage.setItem("duzenleGorev", JSON.stringify({
        ad, saat, tarih: seciliTarih, kullanici: aktifKullanici
      }));
      window.location.href = "duzenle.html";
    }

    function yeniGorev() {
      window.location.href = `gorev-ekle.html?gun=${gun}&ay=${ay}&yil=${yil}`;
    }

    function yeniNot() {
      window.location.href = `not-ekle.html?gun=${gun}&ay=${ay}&yil=${yil}`;
    }

    function notuOku() {
      window.location.href = `not-oku.html?gun=${gun}&ay=${ay}&yil=${yil}`;
    }

    const notlar = JSON.parse(localStorage.getItem("notlar") || "[]");
    const bugunkuNot = notlar.find(n => n.tarih === seciliTarih && n.kullanici === aktifKullanici);
    if (bugunkuNot) {
      document.getElementById("notOkuBtn").style.display = "block";
    }
  </script>

</body>
</html>

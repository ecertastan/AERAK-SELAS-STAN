<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>G√ºnl√ºk G√∂r√ºn√ºm - AERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background-color: #fef9f4;
      color: #252525;
      display: flex;
      flex-direction: column;
      height: 100vh;
    }

    header {
      display: flex;
      justify-content: space-between;
      padding: 15px 20px;
      font-size: 18px;
      background-color: #f5e9de;
      font-weight: bold;
    }

    #tarih {
      display: none; /* Tarih artƒ±k g√∂r√ºnmeyecek */
    }

    #aera {
      color: #fa5f1a;
      cursor: pointer;
    }

    main {
      flex: 1;
      overflow-y: auto;
      padding: 20px;
    }

    .gorev-kutu {
      border-radius: 10px;
      padding: 12px;
      margin-bottom: 15px;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-direction: column;
      background-color: #666;
    }

    .gorev-icerik {
      display: flex;
      justify-content: space-between;
      width: 100%;
    }

    .gorev-saat {
      font-weight: bold;
    }

    .gorev-butons {
      margin-top: 10px;
      width: 100%;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .gorev-butons button {
      background-color: white;
      border: 1px solid #4a3b2c;
      color: #4a3b2c;
      border-radius: 6px;
      padding: 6px 12px;
      cursor: pointer;
    }

    footer {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
      padding: 15px;
      border-top: 1px solid #ccc;
    }

    footer button {
      padding: 10px 20px;
      background-color: #4a3b2c;
      color: white;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    footer button:hover {
      background-color: #3a2c20;
    }

    #notOkuBtn {
      display: none;
    }
  </style>
</head>
<body>

  <header>
    <div id="tarih">...</div>
    <div id="aera" onclick="window.location.href='anasayfa.html'">AERA</div>
  </header>

  <main id="gorevListesi"></main>

  <footer>
    <button id="gorevEkleBtn">‚ûï G√∂rev Ekle</button>
    <button id="notEkleBtn">üìù Not Ekle</button>
    <button id="notOkuBtn">üìñ Notu Oku</button>
  </footer>

  <script>
    const params = new URLSearchParams(window.location.search);
    const gun = params.get("gun");
    const ay = params.get("ay");
    const yil = params.get("yil");

    const seciliTarih = `${yil}-${ay.padStart(2, '0')}-${gun.padStart(2, '0')}`;
    const [y, m, d] = seciliTarih.split("-").map(Number);
    const tarihMetni = new Date(Date.UTC(y, m - 1, d)).toLocaleDateString("tr-TR", { day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById("tarih").textContent = tarihMetni;

    const aktifKullanici = localStorage.getItem("aktifKullanici");
    const tumGorevler = JSON.parse(localStorage.getItem("gorevler") || "[]");
    const bugununGorevleri = tumGorevler
      .filter(g => g.tarih === seciliTarih && g.kullanici === aktifKullanici)
      .sort((a, b) => a.saat.localeCompare(b.saat));

    const container = document.getElementById("gorevListesi");

    if (bugununGorevleri.length === 0) {
      container.innerHTML = "<p>Bu g√ºn i√ßin g√∂rev yok.</p>";
    } else {
      bugununGorevleri.forEach((gorev) => {
        const div = document.createElement("div");
        div.className = "gorev-kutu";
        div.style.backgroundColor = gorev.renk || "#666";

        const icerik = document.createElement("div");
        icerik.className = "gorev-icerik";
        icerik.innerHTML = `<span class="gorev-saat">${gorev.saat}</span><span>${gorev.ad}</span>`;

        const butons = document.createElement("div");
        butons.className = "gorev-butons";

        const btnTamamla = document.createElement("button");
        btnTamamla.textContent = "‚úÖ Tamamla";
        btnTamamla.onclick = (e) => {
          e.stopPropagation();
          const index = tumGorevler.findIndex(g => g.ad === gorev.ad && g.saat === gorev.saat && g.tarih === gorev.tarih && g.kullanici === aktifKullanici);
          if (index !== -1) {
            tumGorevler.splice(index, 1);
            localStorage.setItem("gorevler", JSON.stringify(tumGorevler));
            let xp = parseInt(localStorage.getItem("xp") || "0");
            xp += 10;
            localStorage.setItem("xp", xp);
            window.location.href = "anasayfa.html";
          }
        };

        const btnDuzenle = document.createElement("button");
        btnDuzenle.textContent = "‚úèÔ∏è D√ºzenle";
        btnDuzenle.onclick = (e) => {
          e.stopPropagation();
          const params = new URLSearchParams(gorev).toString();
          window.location.href = "duzenle.html?" + params;
        };

        butons.appendChild(btnTamamla);
        butons.appendChild(btnDuzenle);

        div.appendChild(icerik);
        div.appendChild(butons);

        div.addEventListener("click", () => {
          butons.style.display = butons.style.display === "flex" ? "none" : "flex";
        });

        container.appendChild(div);
      });
    }

    document.getElementById("gorevEkleBtn").onclick = () => {
      window.location.href = `gorev-ekle.html?gun=${gun}&ay=${ay}&yil=${yil}`;
    };

    document.getElementById("notEkleBtn").onclick = () => {
      window.location.href = `not-ekle.html?gun=${gun}&ay=${ay}&yil=${yil}`;
    };

    // NOTU OKU butonunu kontrol et
    const notlar = JSON.parse(localStorage.getItem("notlar") || "[]");
    const bugunNotVar = notlar.find(n => n.tarih === seciliTarih && n.kullanici === aktifKullanici);

    if (bugunNotVar) {
      const btnNotOku = document.getElementById("notOkuBtn");
      btnNotOku.style.display = "inline-block";
      btnNotOku.onclick = () => {
        window.location.href = `notoku.html?gun=${gun}&ay=${ay}&yil=${yil}`;
      };
    }
  </script>

</body>
</html>

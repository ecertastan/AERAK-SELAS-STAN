<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Not Ekle - AERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #fffaf3;
      padding: 20px;
      margin: 0;
      color: #4a3b2c;
    }

    h1 {
      text-align: center;
      color: #fa5f1a;
    }

    #tarih {
      text-align: center;
      font-size: 18px;
      margin-bottom: 20px;
    }

    textarea {
      width: 100%;
      height: 250px;
      padding: 15px;
      font-family: 'Georgia', serif;
      font-size: 16px;
      border: 1px solid #e6d3b3;
      border-radius: 10px;
      background-color: #fef1dc;
      resize: none;
      box-sizing: border-box;
    }

    button {
      display: block;
      margin: 20px auto 0 auto;
      background-color: #4a3b2c;
      color: white;
      border: none;
      padding: 12px 30px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }

    button:hover {
      background-color: #3a2c20;
    }
  </style>
</head>
<body>

  <h1>Günlük Not</h1>
  <div id="tarih">Yükleniyor...</div>
  <textarea id="notAlani" placeholder="Bugün ne düşündün, ne hissettin?"></textarea>
  <button onclick="kaydetNot()">Kaydet</button>

  <script>
    const params = new URLSearchParams(window.location.search);
    const gun = params.get("gun");
    const ay = params.get("ay");
    const yil = params.get("yil");
    const seciliTarih = `${yil}-${ay.padStart(2, '0')}-${gun.padStart(2, '0')}`;
    const aktifKullanici = localStorage.getItem("aktifKullanici");

    const tarihMetni = new Date(seciliTarih).toLocaleDateString("tr-TR", { day: 'numeric', month: 'long', year: 'numeric' });
    document.getElementById("tarih").textContent = tarihMetni;

    const textarea = document.getElementById("notAlani");
    const notlar = JSON.parse(localStorage.getItem("notlar") || "[]");
    const mevcutNot = notlar.find(n => n.tarih === seciliTarih && n.kullanici === aktifKullanici);

    if (mevcutNot) {
      textarea.value = mevcutNot.metin;
    }

    function kaydetNot() {
      const yeniMetin = textarea.value.trim();

      if (yeniMetin === "") {
        alert("Not boş olamaz.");
        return;
      }

      const digerNotlar = notlar.filter(n => !(n.tarih === seciliTarih && n.kullanici === aktifKullanici));
      digerNotlar.push({ tarih: seciliTarih, metin: yeniMetin, kullanici: aktifKullanici });

      localStorage.setItem("notlar", JSON.stringify(digerNotlar));
      alert("Not kaydedildi.");
      window.location.href = `gun.html?gun=${gun}&ay=${ay}&yil=${yil}`;
    }
  </script>

</body>
</html>

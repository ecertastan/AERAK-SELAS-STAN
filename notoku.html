<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Not Oku - AERA</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Georgia', serif;
      background-color: #fffaf3;
      padding: 20px;
      margin: 0;
      color: #4a3b2c;
    }

    h1 {
      text-align: center;
      color: #fa5f1a;
    }

    #tarih {
      text-align: center;
      font-size: 18px;
      margin-bottom: 20px;
    }

    #notMetni {
      background-color: #fef1dc;
      border: 1px solid #e6d3b3;
      padding: 20px;
      border-radius: 10px;
      white-space: pre-wrap;
      min-height: 200px;
      font-size: 16px;
      font-family: 'Georgia', serif;
    }

    .butonlar {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 20px;
    }

    .butonlar button {
      background-color: #4a3b2c;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 8px;
      font-size: 14px;
      cursor: pointer;
    }

    .butonlar button:hover {
      background-color: #3a2c20;
    }

    select {
      display: block;
      margin: 0 auto 20px auto;
      padding: 10px;
      font-size: 16px;
    }
  </style>
</head>
<body>

  <h1>AERA Not</h1>
  <div id="tarih"></div>

  <div id="tarihSeciciKapsayici" style="display:none;">
    <select id="tarihSecici"></select>
  </div>

  <div id="notMetni">Yükleniyor...</div>

  <div class="butonlar">
    <button id="silBtn">Notu Sil</button>
    <button id="duzenleBtn">Notu Düzenle</button>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    const kaynak = params.get("kaynak");
    const aktifKullanici = localStorage.getItem("aktifKullanici");
    const notlar = JSON.parse(localStorage.getItem("notlar") || "[]");
    const notMetni = document.getElementById("notMetni");
    const tarihDiv = document.getElementById("tarih");
    const silBtn = document.getElementById("silBtn");
    const duzenleBtn = document.getElementById("duzenleBtn");

    function gosterNot(tarihStr) {
      const [yil, ay, gun] = tarihStr.split("-");
      const tarihMetni = new Date(tarihStr).toLocaleDateString("tr-TR", { day: 'numeric', month: 'long', year: 'numeric' });
      tarihDiv.textContent = tarihMetni;

      const notObj = notlar.find(n => n.tarih === tarihStr && n.kullanici === aktifKullanici);
      if (notObj) {
        notMetni.textContent = notObj.metin;
        silBtn.style.display = "inline-block";
        duzenleBtn.style.display = "inline-block";

        silBtn.onclick = () => {
          const guncelNotlar = notlar.filter(n => !(n.tarih === tarihStr && n.kullanici === aktifKullanici));
          localStorage.setItem("notlar", JSON.stringify(guncelNotlar));
          alert("Not silindi.");
          window.location.href = `not-ekle.html?gun=${gun}&ay=${ay}&yil=${yil}`;
        };

        duzenleBtn.onclick = () => {
          window.location.href = `not-ekle.html?gun=${gun}&ay=${ay}&yil=${yil}`;
        };
      } else {
        notMetni.textContent = "Bu tarih için not bulunamadı.";
        silBtn.style.display = "none";
        duzenleBtn.style.display = "none";
      }
    }

    if (kaynak === "anasayfa") {
      // Scroll ile tarih seçtir
      const tarihSecici = document.getElementById("tarihSecici");
      const tarihSeciciKapsayici = document.getElementById("tarihSeciciKapsayici");
      tarihSeciciKapsayici.style.display = "block";

      const kullaniciNotlari = notlar.filter(n => n.kullanici === aktifKullanici);
      kullaniciNotlari.forEach(n => {
        const option = document.createElement("option");
        option.value = n.tarih;
        const [y, m, d] = n.tarih.split("-");
        option.textContent = new Date(n.tarih).toLocaleDateString("tr-TR", { day: 'numeric', month: 'long', year: 'numeric' });
        tarihSecici.appendChild(option);
      });

      if (kullaniciNotlari.length > 0) {
        tarihSecici.onchange = () => gosterNot(tarihSecici.value);
        tarihSecici.value = kullaniciNotlari[0].tarih;
        gosterNot(tarihSecici.value);
      } else {
        tarihDiv.textContent = "Hiç not bulunamadı.";
        notMetni.textContent = "";
        silBtn.style.display = "none";
        duzenleBtn.style.display = "none";
      }

    } else {
      // Doğrudan gün.html'den gelen yapı
      const gun = params.get("gun");
      const ay = params.get("ay");
      const yil = params.get("yil");
      const seciliTarih = `${yil}-${ay.padStart(2, '0')}-${gun.padStart(2, '0')}`;
      gosterNot(seciliTarih);
    }
  </script>

</body>
</html>
